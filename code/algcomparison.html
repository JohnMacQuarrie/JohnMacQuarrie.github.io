 <!--PREAMBLE--><html><head>





    

    <title>HH code</title>



     <style type="text/css">
    
    #title{
        color:#845B99;
        position: absolute;
        font-size:40px;
        top:23px;
        right:52;
        left: 252px;
        width: 683px;
        vertical-align:bottom;
        height: 55px;
    }
    
    #yetanotherbox{
     left: 227px;
    top: 79px;
    position: absolute;
    }
    
    #backgroundbox{
    border: 0px solid black;

    width: 725px;
    background-color: #D6FF99;
    background-image:url(pictures/bordertemp.GIF);
    background-repeat:no-repeat;
    }
          
    #textbox{
    padding:15px;
    }
    
    #coolmenu{
    border: 0px solid black;
    width: 12em;
    background-color: #FFFF99;
    }
    
    #coolmenu a{
    font: bold 13px Arial, Helvetica, sans-serif;
    padding: 2px;
    padding-left: 4px;
    display: block;
    width: 100%;
    color: #4B543E;
    text-decoration: none;
    border-bottom: 1px dotted #4B543E;
    }
    
    html>body #coolmenu a{
    width: auto;
    }
    
    #coolmenu a:hover{
    background-color: #FFFF99;
    color: #845B99;
    }
    
    #tabledescription{
    width: 100%;
    height: 3em;
    padding: 0px;
    filter:alpha(opacity=0);
    
    color:#4B543E;
    }
    
    .style1 {font-family: "Times New Roman", Times, serif}
    body {
        background-color: #FFFF99;
    }
    </style>
    
    <script type="text/javascript">
    
    // Cool CSS Menu- By JavaScriptKit.com (http://www.javascriptkit.com)
    // For this and over 400+ free scripts, visit JavaScript Kit- http://www.javascriptkit.com/
    // Fading routine based on Dynamic Drive script: http://www.dynamicdrive.com/dynamicindex4/highlightgrad.htm
    // This notice must stay intact for use
    
    var baseopacity=0
    
    function showtext(thetext){
    if (!document.getElementById)
    return
    textcontainerobj=document.getElementById("tabledescription")
    browserdetect=textcontainerobj.filters? "ie" : typeof textcontainerobj.style.MozOpacity=="string"? "mozilla" : ""
    instantset(baseopacity)
    document.getElementById("tabledescription").innerHTML=thetext
    highlighting=setInterval("gradualfade(textcontainerobj)",50)
    }
    
    function hidetext(){
    cleartimer()
    instantset(baseopacity)
    }
    
    function instantset(degree){
    if (browserdetect=="mozilla")
    textcontainerobj.style.MozOpacity=degree/100
    else if (browserdetect=="ie")
    textcontainerobj.filters.alpha.opacity=degree
    else if (document.getElementById && baseopacity==0)
    document.getElementById("tabledescription").innerHTML=""
    }
    
    function cleartimer(){
    if (window.highlighting) clearInterval(highlighting)
    }
    
    function gradualfade(cur2){
    if (browserdetect=="mozilla" && cur2.style.MozOpacity<1)
    cur2.style.MozOpacity=Math.min(parseFloat(cur2.style.MozOpacity)+0.2, 0.99)
    else if (browserdetect=="ie" && cur2.filters.alpha.opacity<100)
    cur2.filters.alpha.opacity+=20
    else if (window.highlighting)
    clearInterval(highlighting)
    }
    
    </script>
            
            <script language="javascript">

            addEvent(window, "load", init);
    
    function init()
    {
    
        form = document.getElementById("form1");
        addEvent(form, "submit", correctSubmitHandler);
    }
    
    function correctSubmitHandler(e)
    {
        //alert("Correct Submit Handler");
        if (e && e.preventDefault)
                e.preventDefault();
        
        form = document.getElementById("form1");
        document.location=form.answer.value+'.html';
        return false;
    }
    
    function doSubmit()
    {
        alert("doSubmit");
        return false;
    }
    
    function addEvent(obj, evType, fn)
    {
        if (obj.addEventListener)
        {
            obj.addEventListener(evType, fn, false);
            return true;
        }
        else if (obj.attachEvent)
        {
            var r = obj.attachEvent("on"+evType, fn);
            return r;
        }
        else
        {
            return false;
        }
    }
    
            </script>	
    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$']] },
      TeX: {
      Macros: {
      R: "{\\mathbb R}",
      N: "{\\mathbb N}",
      C: "{\\mathbb C}",
      Z: "{\\mathbb Z}",
      Q: "{\\mathbb Q}",
      mdc: ["{\\mbox{mdc}(#1,#2)}", 2]
      }}});
      </script>
          
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
      </script>

</head> 




    <!--PREAMBLE-->


<body>

    

<div id="title">
  <div align="right">HH for incidence algebras, Sage code</div>
</div>




  </p>
  <div id="tabledescription"></div>
</div>


<div id="yetanotherbox">
<div id="backgroundbox">
<div id="textbox">


 <p>
   

<pre><code class="language-python">
Indeterminate = libgap.eval("I:=function(x,y) return Indeterminate(x,y); end;")
StringFormatted = libgap.eval("S:=function(x,y,z,w) return StringFormatted(x,y,z,w);end;")
StF = libgap.eval("St:=function(x,y,z) return StringFormatted(x,y,z);end;")
VectorSpace = libgap.eval("V:=function(x,y,z) return VectorSpace(x,y,z);end;")
Mapadeciclos = libgap.eval(
    "Mapadeciclos:=function(Source,Range,cycle)local Im,i,f,D;"
    "D:=GeneratorsOfVectorSpace(Source);Im:=[];"
    "for i in [1..Length(cycle)] do "
    "Add(Im, LinearCombination(Basis(Range), cycle[i][1])); od;"
    "f:=LeftModuleGeneralMappingByImages(Source, Range, D, Im);"
    "return f;end;"
)
Z_CycleSpace = libgap.eval(
    "Z_CycleSpace:=function(cycles,zlist,Source,f)local K, zSubspace, i, j, aux, "
    "VerticesOfCycles, CoefficientsOfCycles, T;"
    "CoefficientsOfCycles:=[];"
    "if Length(zlist)&gt;0 then "
    "K:=BasisVectors(Basis((Kernel(RestrictedMapping(f, Subspace(Source,zlist))))));"
    "for i in [1..Length(K)] do "
    "Add(CoefficientsOfCycles,Coefficients(Basis(Source), K[i]));"
    "od;fi;"
    "T:=CoefficientsOfCycles;return T;end;"
)
BasisComplement = libgap.eval(
    "BasisComplement:=function(Aux_Bzminus,Aux_Ciplus, i, OurDomain,OurField) "
    "local F,Kzminus,t,BC; BC:=[]; F:=OurField^Length(OurDomain);"
    "if Length(Aux_Bzminus)&gt;0 then "
    "KZminus:=Subspace(F, Aux_Bzminus);"
    "for t in [1..Length(Aux_Ciplus[i][1])] do "
    "if (Aux_Ciplus[i][1][t] in KZminus)=false then "
    "Add(BC, [Aux_Ciplus[i][1][t], Aux_Ciplus[i][2]]); "
    "Add(Aux_Bzminus, Aux_Ciplus[i][1][t]); "
    "KZminus:=Subspace(F, Aux_Bzminus);fi;od;"
    "else "
    "for t in [1..Length(Aux_Ciplus[i][1])] do "
    "Add(BC, [Aux_Ciplus[i][1][t],Aux_Ciplus[i][2]]);od; fi; "
    "return BC;end;"
)


def iCycles(X, c):
    # c = characteristic of OurField
    G = X.with_bounds().canonical_label()
    h = G.minimal_elements()[0]
    y = G.maximal_elements()[0]
    xplus = G.upper_covers(h)

    if c == 0:
        OurField = QQ
    else:
        OurField = GF(c)

    candidates = list(G)
    q = 1

    OurDomain = [Indeterminate(OurField, "x")]
    iminusCycles = [[1, h]]

    iCycles = []
    for j in xplus:
        iCycles.append([[1], j])

    if len(iCycles) == 0:
        q = -1
    else:
        terms = [f" P_{item[1]}" for item in iCycles]
        result = " + ".join(terms)
        q += 1

    while q != -1:
        OurCodomain = OurDomain
        OurDomain = []

        if q == 2:
            for i in range(len(iCycles)):
                OurDomain.append(
                    Indeterminate(
                        OurField,
                        StF("[{}, {}]", OurCodomain[0], iCycles[i][1])
                    )
                )
        else:
            for i in range(len(iCycles)):
                OurDomain.append(
                    Indeterminate(
                        OurField,
                        StringFormatted("[w^{}_{}, {}]", q - 1, i, iCycles[i][1])
                    )
                )

        SourceSpace = VectorSpace(OurField, OurDomain, "basis")
        RangeSpace = VectorSpace(OurField, OurCodomain, "basis")
        f = Mapadeciclos(SourceSpace, RangeSpace, iCycles)

        iminusCycles = []
        for i in range(len(iCycles)):
            iminusCycles.append([iCycles[i][0], Integer(iCycles[i][1])])

        iCycles = []
        Aux_Ciplus = []

        for k in candidates:
            zSubspace = []
            for i in range(len(iminusCycles)):
                if G.is_less_than(iminusCycles[i][1], k):
                    zSubspace.append(OurDomain[i])
            if zSubspace != []:
                T = Z_CycleSpace(iminusCycles, zSubspace, SourceSpace, f)
                if T != []:
                    Aux_Ciplus.append([T, k])

        I = list(range(len(Aux_Ciplus)))

        for i in I:
            Aux_Bzminus = set()
            for j in I:
                if Aux_Ciplus[j][1] in G.lower_covers(Aux_Ciplus[i][1]):
                    Aux_Bzminus.update(Aux_Ciplus[j][0])
            BC = BasisComplement(
                list(Aux_Bzminus), Aux_Ciplus, i + 1, OurDomain, OurField
            )
            if len(BC) != 0:
                for a in BC:
                    iCycles.append(a)

        if len(iCycles) == 0:
            print("The i-Cycles were calculated")
            q = -1
        else:
            q += 1


import warnings
warnings.filterwarnings("ignore", category=DeprecationWarning)
import time


def PrepareMagma(G):
    X = G.with_bounds().canonical_label()
    xstar = X.minimal_elements()[0]
    m = X.height()

    Z = X.relabel()
    Z = Z.relabel(lambda s: s + 1)
    Q = DiGraph([(x, y, 'x' + str(x) + str(y)) for x, y in Z.cover_relations()])
    SG = Q.path_semigroup()
    A = SG.algebra(ZZ)

    rels = []
    for a, b in Z.relations():
        if Q.in_degree(b) &gt; 1 and Q.out_degree(a) &gt; 1:
            paths = Q.all_paths(a, b)
            if len(paths) &gt; 1:
                prod_paths = [
                    A.prod(A(Q.edge_label(pa[i], pa[i + 1]))
                           for i in range(len(pa) - 1))
                    for pa in paths
                ]
                rels += [prod_paths[0] - pi for pi in prod_paths[1:]]

    n = len(Q)
    var(' '.join([f'e{i}' for i in range(1, n + 1)]))
    V = [eval(f'e{i}') for i in range(1, n + 1)]

    Lista = Q.num_verts(), [list(e) for e in Q.edges()]
    L = Lista[1]
    T = []
    for element in L:
        a, b, x = element
        V.append(var(x))
        T.append((a, b))

    vars_str = "F&lt;" + ", ".join(str(v) for v in V) + "&gt;"
    free_algebra_str = f"FreeAlgebra(RationalField(), {len(V)})"
    rels_str = ", ".join(str(r) for r in rels)
    pairs_str = ", ".join(f"&lt;{a},{b}&gt;" for a, b in T)

    magma.eval(f"{vars_str} := {free_algebra_str};")
    magma.eval(f"BA := BasicAlgebra(F, [{rels_str}], {n}, [{pairs_str}]);")
    magma.eval("S := SimpleModule(BA,1);")
    magma.eval(f"m_saved := {int(m)};")

    print("Magma is ready")
</code></pre>

</p>


</div>
</div>

<div>&nbsp;</div>
</div>

</body>


</html>













